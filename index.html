<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat com Gemini</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-screen flex bg-gray-100">
  <div id="root" class="w-full"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function ChatApp() {
      const [projects, setProjects] = useState([]);
      const [chats, setChats] = useState([]);
      const [activeChat, setActiveChat] = useState(null);
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState("");

      // carregar do localStorage
      useEffect(() => {
        const savedProjects = JSON.parse(localStorage.getItem("projects")) || [];
        const savedChats = JSON.parse(localStorage.getItem("chats")) || [];
        setProjects(savedProjects);
        setChats(savedChats);
      }, []);

      // salvar no localStorage
      useEffect(() => {
        localStorage.setItem("projects", JSON.stringify(projects));
      }, [projects]);

      useEffect(() => {
        localStorage.setItem("chats", JSON.stringify(chats));
      }, [chats]);

      async function handleSendMessage() {
        if (!input.trim()) return;

        const userMessage = { sender: "user", text: input };
        setMessages((prev) => [...prev, userMessage]);

        try {
          const response = await fetch(
            "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=SUA_API_KEY_AQUI",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [{ role: "user", parts: [{ text: input }] }],
              }),
            }
          );

          const data = await response.json();
          console.log("Resposta:", data);

          const reply =
            data?.candidates?.[0]?.content?.parts?.[0]?.text ||
            "Não entendi, pode repetir?";

          setMessages((prev) => [...prev, { sender: "gemini", text: reply }]);
        } catch (error) {
          console.error("Erro API:", error);
          setMessages((prev) => [
            ...prev,
            { sender: "gemini", text: "⚠️ Erro ao conectar na API." },
          ]);
        }

        setInput("");
      }

      return (
        <div className="flex h-screen">
          {/* Sidebar */}
          <div className="w-64 bg-gray-900 text-white flex flex-col p-4">
            <h2 className="text-xl font-bold mb-4">Projetos</h2>
            <ul className="flex-1 overflow-y-auto">
              {projects.map((p, i) => (
                <li key={i} className="mb-2 bg-gray-700 p-2 rounded">
                  {p}
                </li>
              ))}
            </ul>

            <h2 className="text-xl font-bold mt-4 mb-2">Chats</h2>
            <ul className="flex-1 overflow-y-auto">
              {chats.map((c, i) => (
                <li
                  key={i}
                  className={`mb-2 p-2 rounded cursor-pointer ${
                    activeChat === i ? "bg-blue-600" : "bg-gray-700"
                  }`}
                  onClick={() => setActiveChat(i)}
                >
                  {c}
                </li>
              ))}
            </ul>
          </div>

          {/* Área principal do chat */}
          <div className="flex-1 flex flex-col">
            <div className="flex-1 overflow-y-auto p-4 bg-gray-100">
              {messages.map((m, i) => (
                <div
                  key={i}
                  className={`mb-2 p-2 rounded max-w-lg ${
                    m.sender === "user"
                      ? "bg-blue-500 text-white ml-auto"
                      : "bg-gray-300 text-black"
                  }`}
                >
                  <b>{m.sender === "user" ? "Você" : "Gemini"}:</b> {m.text}
                </div>
              ))}
            </div>
            <div className="p-4 bg-white border-t flex">
              <input
                className="flex-1 border rounded p-2 mr-2"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyDown={(e) => e.key === "Enter" && handleSendMessage()}
                placeholder="Digite sua mensagem..."
              />
              <button
                className="bg-blue-600 text-white px-4 py-2 rounded"
                onClick={handleSendMessage}
              >
                Enviar
              </button>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<ChatApp />);
  </script>
</body>
</html>
